{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="container" style="padding-top: 100px; padding-bottom: 50px; max-width: 1000px;">

    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 style="color: #4b4a4a; text-shadow: 0 1px 9px #777777;">Request Details</h2>
        <a href="{% url 'admin_requests_list' %}" class="btn btn-outline-light"
            style=" border-radius: 50px; padding: 8px 20px; ">
            <span class="material-symbols-outlined"
                style=" vertical-align: middle; font-size: 18px; color: #4b4a4a!important; ">arrow_back</span>
            Back to List
        </a>
    </div>

    <div class="glass-card"
        style="padding: 40px; border-radius: 16px; background: #1e2124; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 10px 30px rgba(0,0,0,0.2);">

        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-bottom: 40px;">

            <div>
                <h3 style="color: #00f260; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px;">
                    Airport Information
                </h3>

                <div style="margin-bottom: 20px;">
                    <label style="color: #888; font-size: 0.9rem;">Airport Name</label>
                    <div style="color: #fff; font-size: 1.2rem; font-weight: bold;">{{ req.airport_name }}</div>
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="color: #888; font-size: 0.9rem;">IATA Code</label>
                    <div>
                        <span
                            style="background: rgba(255,255,255,0.1); color: #fff; padding: 5px 10px; border-radius: 6px; font-family: monospace;">
                            {{ req.airport_code }}
                        </span>
                    </div>
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="color: #888; font-size: 0.9rem;">Location</label>
                    <div style="color: #fff; font-size: 1.1rem;">
                        <span class="material-symbols-outlined"
                            style="font-size: 16px; vertical-align: middle; color: #666;">location_on</span>
                        {{ req.city }}, {{ req.country }}
                    </div>
                </div>
            </div>

            <div>
                <h3 style="color: #0575e6; margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px;">
                    Contact & Plan
                </h3>

                <div style="margin-bottom: 20px;">
                    <label style="color: #888; font-size: 0.9rem;">Admin Email</label>
                    <div style="color: #fff; font-size: 1.1rem;">{{ req.admin_email }}</div>
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="color: #888; font-size: 0.9rem;">Phone Number</label>
                    <div style="color: #fff; font-size: 1.1rem;">{{ req.admin_phone }}</div>
                </div>

                <div style="margin-bottom: 20px;">
                    <label style="color: #888; font-size: 0.9rem;">Selected Plan</label>
                    <div style="margin-top: 5px;">
                        {% if req.selected_plan == '1_year' %}
                        <span
                            style="background: rgba(23, 162, 184, 0.15); color: #17a2b8; padding: 6px 15px; border-radius: 20px; font-weight: bold;">1
                            Year Plan</span>
                        {% elif req.selected_plan == '3_years' %}
                        <span
                            style="background: rgba(0, 123, 255, 0.15); color: #007bff; padding: 6px 15px; border-radius: 20px; font-weight: bold;">3
                            Years Plan</span>
                        {% else %}
                        <span
                            style="background: rgba(255, 193, 7, 0.15); color: #ffc107; padding: 6px 15px; border-radius: 20px; font-weight: bold;">5
                            Years Plan</span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <div style="margin-bottom: 25px;">
            <h3 style="color: #9b59b6; margin-bottom: 12px; border-bottom: 1px solid #333; padding-bottom: 8px;">
                Submitted Files
            </h3>
            <div style="display:flex; gap:12px; flex-wrap:wrap; align-items:center;">
                {% if req.image %}
                <a href="{{ req.image.url }}" target="_blank" class="file-action-btn btn-view"
                    title="View Airport Image">
                    <span class="material-symbols-outlined">image</span>
                    <span>View Airport Image</span>
                </a>
                <img src="{{ req.image.url }}" alt="Airport Image"
                    style="max-width: 120px; max-height: 80px; border-radius: 8px; border: 1px solid #333; background: #fff; margin-left: 8px; vertical-align: middle;" />
                {% endif %}
                {% if req.official_license %}
                <a href="{{ req.official_license.url }}" data-file-url="{{ req.official_license.url }}"
                    class="file-action-btn btn-view" title="View Official License">
                    <span class="material-symbols-outlined">visibility</span>
                    <span>View Official License</span>
                </a>
                <a href="{{ req.official_license.url }}" download class="file-action-btn btn-download"
                    title="Download Official License">
                    <span class="material-symbols-outlined">download</span>
                    <span>Download</span>
                </a>

                {% with fname=req.official_license.name|lower %}
                {% if fname|slice:"-4:" == ".pdf" %}
                <span class="file-badge pdf">PDF</span>
                {% elif fname|slice:"-4:" == ".jpg" or fname|slice:"-4:" == ".png" or fname|slice:"-5:" == ".jpeg" %}
                <span class="file-badge img">IMG</span>
                {% else %}
                <span class="file-badge other">FILE</span>
                {% endif %}
                {% endwith %}
                {% else %}
                <span style="color:#777;">No official license uploaded.</span>
                {% endif %}

                {% if req.commercial_record %}
                <a href="{{ req.commercial_record.url }}" data-file-url="{{ req.commercial_record.url }}"
                    class="file-action-btn btn-view" title="View Commercial Record">
                    <span class="material-symbols-outlined">visibility</span>
                    <span>View Commercial Record</span>
                </a>
                <a href="{{ req.commercial_record.url }}" download class="file-action-btn btn-download"
                    title="Download Commercial Record">
                    <span class="material-symbols-outlined">download</span>
                    <span>Download</span>
                </a>

                {% with fname=req.commercial_record.name|lower %}
                {% if fname|slice:"-4:" == ".pdf" %}
                <span class="file-badge pdf">PDF</span>
                {% elif fname|slice:"-4:" == ".jpg" or fname|slice:"-4:" == ".png" or fname|slice:"-5:" == ".jpeg" %}
                <span class="file-badge img">IMG</span>
                {% else %}
                <span class="file-badge other">FILE</span>
                {% endif %}
                {% endwith %}
                {% endif %}
            </div>
        </div>

        <div
            style="border-top: 1px solid #333; padding-top: 30px; display: flex; gap: 15px; justify-content: flex-end;">

            <button id="rejectBtn" type="button"
                style="padding: 12px 30px; background: rgba(255, 71, 87, 0.12); color: #ff4757; text-decoration: none; border-radius: 8px; font-weight: bold; border: 1px solid rgba(255, 71, 87, 0.3); transition: 0.15s; cursor: pointer;">
                Reject Request
            </button>

            <a href="{% url 'admin_approve_request' req.id %}"
                onclick="return confirm('Are you sure? This will create the airport and send login credentials.');"
                style="padding: 12px 30px; background: linear-gradient(135deg, #00f260, #0575e6); color: white; text-decoration: none; border-radius: 8px; font-weight: bold; box-shadow: 0 4px 15px rgba(0, 242, 96, 0.3);">
                Approve & Create Airport
            </a>

        </div>
        <div id="rejectModal"
            style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); z-index:2500; align-items:center; justify-content:center;">
            <div
                style="width:min(640px,92vw); background:#111214; padding:18px; border-radius:10px; box-shadow:0 12px 40px rgba(0,0,0,0.6);">
                <h3 style="color:#fff; margin:0 0 8px 0;">Reject Subscription Request</h3>
                <p style="color:#bbb; margin:0 0 12px 0;">Inform the applicant and optionally edit the destination
                    email.</p>
                <form method="post" action="{% url 'admin_reject_request' req.id %}">
                    {% csrf_token %}
                    <div style="margin-bottom:10px;">
                        <label style="color:#ddd; font-weight:700; display:block; margin-bottom:6px;">Send To
                            (email)</label>
                        <input type="email" name="email" value="{{ req.admin_email }}" required
                            style="width:100%; padding:10px; border-radius:8px; border:1px solid #222; background:#0f1416; color:#fff;">
                    </div>
                    <div style="margin-bottom:14px;">
                        <label style="color:#ddd; font-weight:700; display:block; margin-bottom:6px;">Reason (will be
                            included in email)</label>
                        <textarea name="reason" rows="4" placeholder="Provide reason for rejection"
                            style="width:100%; padding:10px; border-radius:8px; border:1px solid #222; background:#0f1416; color:#fff;"></textarea>
                    </div>
                    <div style="display:flex; gap:10px; justify-content:flex-end;">
                        <button type="button" id="rejectCancel"
                            style="padding:10px 16px; border-radius:8px; background:transparent; border:1px solid #333; color:#fff;">Cancel</button>
                        <button type="submit"
                            style="padding:10px 16px; border-radius:8px; background:linear-gradient(90deg,#ff6b6b,#ff4757); border:0; color:#fff; font-weight:800;">Send
                            Rejection</button>
                    </div>
                </form>
            </div>
        </div>

    </div>
</div>
<script src="{% static 'js/file_preview.js' %}"></script>
<script>
    (function () {
        const btn = document.getElementById('rejectBtn');
        const modal = document.getElementById('rejectModal');
        const cancel = document.getElementById('rejectCancel');
        if (btn && modal) {
            btn.addEventListener('click', function () { modal.style.display = 'flex'; });
        }
        if (cancel && modal) {
            cancel.addEventListener('click', function () { modal.style.display = 'none'; });
        }
        document.addEventListener('keydown', function (e) { if (e.key === 'Escape' && modal) { modal.style.display = 'none'; } });
    })();
</script>
{% endblock %}